# ?? Video Chat Application - New Structure Guide

## ?? Project Structure

```
VideoChatingApp.WebRTC/
??? client-app/                    # ?? Vue 3 Frontend Application
?   ??? src/
?   ?   ??? assets/
?   ?   ??? components/
?   ?   ??? models/
?   ?   ??? services/
?   ?   ??? views/
?   ?   ??? App.vue
?   ?   ??? main.ts
?   ??? index.html
?   ??? package.json
?   ??? vite.config.ts
?   ??? tsconfig.json
?   ??? tailwind.config.js
?
??? Core/                          # ?? .NET Core Business Logic
?   ??? Interfaces/
?   ??? Models/
?
??? Hubs/                          # ?? SignalR Hub
?   ??? VideoCallHub.cs
?
??? Managers/                      # ?? Business Managers
?   ??? UserManager.cs
?   ??? RoomManager.cs
?
??? wwwroot/                       # ?? Static Files & Build Output
?   ??? dist/                      # (Generated by Vue build)
?       ??? index.html
?       ??? assets/
?
??? Program.cs                     # ?? .NET Application Entry
??? start-dev.ps1                  # ?? Development startup script
??? build-prod.ps1                 # ???  Production build script
??? install-deps.ps1               # ?? Dependency installation script
??? VideoChatingApp.WebRTC.csproj
```

## ?? Quick Start

### Prerequisites
- ? Node.js 18+ ([Download](https://nodejs.org/))
- ? .NET 9 SDK ([Download](https://dotnet.microsoft.com/download))
- ? PowerShell (for scripts)

### 1. Install Dependencies
```powershell
.\install-deps.ps1
```

Or manually:
```powershell
# Install client dependencies
cd client-app
npm install

# Install .NET dependencies
cd ..
dotnet restore
```

### 2. Start Development Environment
```powershell
.\start-dev.ps1
```

This will:
1. ? Start .NET backend on `http://localhost:5000`
2. ? Start Vue dev server on `http://localhost:3000`
3. ? Open 2 PowerShell windows (one for each server)

### 3. Open Browser
Navigate to: **http://localhost:3000**

## ??? Development Workflow

### Option 1: Automated (Recommended)
```powershell
# Start both servers
.\start-dev.ps1

# Access the application
# Frontend: http://localhost:3000
# Backend:  http://localhost:5000
```

### Option 2: Manual
**Terminal 1 - Backend:**
```powershell
dotnet run
# or for auto-reload on code changes:
dotnet watch run
```

**Terminal 2 - Frontend:**
```powershell
cd client-app
npm run dev
```

### Making Changes

#### Frontend Changes (Vue/TypeScript/CSS)
1. Edit files in `client-app/src/`
2. Browser auto-reloads with hot module replacement
3. No manual refresh needed

#### Backend Changes (C#)
1. Edit files in `Core/`, `Hubs/`, `Managers/`
2. If using `dotnet watch run`, server auto-restarts
3. Otherwise, stop and restart `dotnet run`

## ??? Building for Production

### Option 1: Automated Script
```powershell
.\build-prod.ps1
```

### Option 2: Manual Build
```powershell
# Build Vue app
cd client-app
npm run build

# Build .NET app
cd ..
dotnet build -c Release
```

### Build Output
- Vue app builds to: `wwwroot/dist/`
- .NET app builds to: `bin/Release/net9.0/`

## ?? Running Production Build

### Local Production Test
```powershell
dotnet run --configuration Release
```

Then open: **http://localhost:5000** (or https://localhost:5001)

### Publish for Deployment
```powershell
dotnet publish -c Release -o ./publish
```

This creates a self-contained deployment in the `publish/` folder.

## ?? Client App Structure

The `client-app/` folder contains the complete Vue 3 SPA:

### Key Files
- **`src/main.ts`** - Application entry point
- **`src/App.vue`** - Root component
- **`src/views/`** - Page components (Home, VideoChat, Room)
- **`src/components/`** - Reusable components
- **`src/services/`** - SignalR and WebRTC services
- **`vite.config.ts`** - Build configuration
- **`package.json`** - NPM dependencies

### Available Commands (in client-app/)
```bash
npm run dev      # Start dev server
npm run build    # Build for production
npm run preview  # Preview production build
```

## ?? How It Works

### Development Mode
```
Browser (localhost:3000)
    ?
Vite Dev Server
    ? (proxy /videocallhub)
ASP.NET Core (localhost:5000)
    ?
SignalR Hub
```

### Production Mode
```
Browser (localhost:5000)
    ?
ASP.NET Core
    ? (serves static files from wwwroot/dist/)
Vue SPA (index.html + JS/CSS)
    ? (connects to SignalR)
SignalR Hub (/videocallhub)
```

## ?? Routes

The Vue SPA uses Vue Router for client-side routing:

| Route | Component | Description |
|-------|-----------|-------------|
| `/` | Home.vue | Landing page |
| `/video-chat` | VideoChat.vue | Main video chat interface |
| `/room/:roomId` | Room.vue | Specific room access |

### How SPA Routing Works

1. **Development**: Vite dev server handles all routes
2. **Production**: ASP.NET Core has `MapFallbackToFile("dist/index.html")` which:
   - Serves `index.html` for all non-API routes
   - Vue Router takes over and renders the correct component
   - Allows direct navigation to `/video-chat` or `/room/123`

## ?? Configuration

### Vite Proxy (client-app/vite.config.ts)
```typescript
server: {
  port: 3000,
  proxy: {
    '/videocallhub': {
      target: 'http://localhost:5000',
      ws: true,              // Enable WebSocket
      changeOrigin: true
    }
  }
}
```

### CORS (Program.cs)
```csharp
options.AddPolicy("AllowAll", policy =>
{
    policy.WithOrigins("http://localhost:3000", "https://localhost:3000")
          .AllowAnyMethod()
          .AllowAnyHeader()
          .AllowCredentials();
});
```

### Build Output (vite.config.ts)
```typescript
build: {
  outDir: '../wwwroot/dist',  // Output to parent folder
  emptyOutDir: true
}
```

## ?? Project Scripts

### PowerShell Scripts

| Script | Purpose |
|--------|---------|
| `install-deps.ps1` | Install all dependencies |
| `start-dev.ps1` | Start development environment |
| `build-prod.ps1` | Build for production |

### NPM Scripts (client-app/package.json)

| Script | Command | Purpose |
|--------|---------|---------|
| `dev` | `vite` | Start dev server |
| `build` | `vue-tsc && vite build` | Build with type checking |
| `preview` | `vite preview` | Preview production build |

### .NET Commands

| Command | Purpose |
|---------|---------|
| `dotnet run` | Run in development |
| `dotnet watch run` | Run with auto-reload |
| `dotnet build` | Build the project |
| `dotnet build -c Release` | Build for production |
| `dotnet publish` | Create deployment package |

## ?? Troubleshooting

### Issue: "Port 3000 already in use"
**Solution**: Change port in `client-app/vite.config.ts`:
```typescript
server: { port: 3001 }
```

### Issue: "Cannot connect to SignalR"
**Solution**: 
1. Ensure backend is running: `dotnet run`
2. Check backend is on port 5000
3. Verify proxy config in `vite.config.ts`

### Issue: "Build fails - TypeScript errors"
**Solution**:
```bash
cd client-app
npx vue-tsc --noEmit  # Check for errors
npm run build         # Try build again
```

### Issue: "Frontend can't load in production"
**Solution**:
1. Ensure `npm run build` completed successfully
2. Check `wwwroot/dist/` exists and has files
3. Verify `Program.cs` has `app.MapFallbackToFile("dist/index.html")`

### Issue: "Changes not reflecting"
**Solution**:
- Frontend: Vite should auto-reload (check console)
- Backend: Use `dotnet watch run` for auto-restart
- Hard refresh: Ctrl+Shift+R

## ?? Documentation

- **Client App**: `client-app/README.md` - Vue app specifics
- **API**: `API.md` - SignalR Hub API documentation
- **Architecture**: `ARCHITECTURE.md` - System design
- **Quick Start**: `QUICKSTART.md` - Getting started guide

## ?? Next Steps

1. ? Install dependencies: `.\install-deps.ps1`
2. ? Start development: `.\start-dev.ps1`
3. ? Open browser: http://localhost:3000
4. ? Register a user and test video chat
5. ? Build for production: `.\build-prod.ps1`

## ?? Security Notes

### Development
- ? CORS allows localhost:3000
- ? HTTP is acceptable for local development

### Production
- ?? Use HTTPS (required for WebRTC camera/mic access)
- ?? Restrict CORS to your domain only
- ?? Implement authentication/authorization
- ?? Add rate limiting
- ?? Use TURN servers for NAT traversal

## ?? Deployment Options

### Option 1: Self-Hosted
```powershell
.\build-prod.ps1
dotnet publish -c Release -o ./publish
# Deploy publish/ folder to your server
```

### Option 2: Azure App Service
```powershell
.\build-prod.ps1
# Use Azure CLI or Visual Studio to publish
```

### Option 3: Docker
```bash
docker build -t videochat-app .
docker run -p 80:80 videochat-app
```

## ?? Performance

### Development
- Backend start: ~2-3 seconds
- Frontend start: ~500ms
- HMR: ~50ms

### Production Build
- Vue build: ~3-5 seconds
- .NET build: ~5-10 seconds
- Total: ~10-15 seconds

### Production Bundle Size
- HTML: ~1KB
- CSS: ~12KB (gzipped)
- JS (vendor): ~50KB (gzipped)
- JS (app): ~20KB (gzipped)
- **Total**: ~83KB gzipped

## ?? Summary

The new structure separates concerns:
- ?? **`client-app/`** - Complete Vue 3 SPA with own config
- ?? **Root folder** - .NET Core backend
- ?? **`wwwroot/dist/`** - Built frontend (generated)

Benefits:
- ? Clear separation of frontend/backend
- ? Independent development workflows
- ? Easy to understand and maintain
- ? Standard project structure
- ? Automated scripts for common tasks

---

**Your Vue 3 + .NET 9 Video Chat Application is ready!** ??

**Run `.\start-dev.ps1` to begin!**

# Visual Diagrams & Flows

Complete visual reference for understanding the Video Chat Application architecture and flows.

---

## 1. System Architecture Overview

```
???????????????????????????????????????????????????????????????????????
?                         CLIENT BROWSER                              ?
?                                                                     ?
?  ????????????????????????????????????????????????????????????????  ?
?  ?                      User Interface (Vue.js)                  ?  ?
?  ?  ???????????????  ???????????????  ???????????????????????  ?  ?
?  ?  ?  VideoChat  ?  ?  UserList   ?  ?    VideoGrid        ?  ?  ?
?  ?  ?  Component  ?  ?  Component  ?  ?    Component        ?  ?  ?
?  ?  ???????????????  ???????????????  ???????????????????????  ?  ?
?  ?         ?                 ?                     ?             ?  ?
?  ?????????????????????????????????????????????????????????????????  ?
?            ?                 ?                     ?                ?
?  ?????????????????????????????????????????????????????????????????  ?
?  ?         ?        Service Layer (TypeScript)      ?             ?  ?
?  ?  ???????????????????                    ???????????????????   ?  ?
?  ?  ?  SignalRService ?                    ?  WebRTCService  ?   ?  ?
?  ?  ?  (WebSocket)    ?                    ?  (Media/Peers)  ?   ?  ?
?  ?  ???????????????????                    ???????????????????   ?  ?
?  ??????????????????????????????????????????????????????????????????  ?
?            ?                                         ?                ?
?????????????????????????????????????????????????????????????????????????
             ?                                         ?
        WSS (SignalR)                              WebRTC P2P
             ?                                         ?
?????????????????????????????????????????????????????????????????????????
?                      ASP.NET CORE 9 SERVER                            ?
?                                                                        ?
?  ????????????????????????????????????????????????????????????????    ?
?  ?                    Presentation Layer                         ?    ?
?  ?                      ????????????????                         ?    ?
?  ?                      ?  Program.cs  ?                         ?    ?
?  ?                      ?  (Startup)   ?                         ?    ?
?  ?                      ????????????????                         ?    ?
?  ??????????????????????????????????????????????????????????????????????    ?
?                                ?                                       ?
?  ??????????????????????????????????????????????????????????????????   ?
?  ?               Infrastructure Layer                             ?   ?
?  ?                    ????????????????                            ?   ?
?  ?                    ? VideoCallHub ?                            ?   ?
?  ?                    ?   (SignalR)  ?                            ?   ?
?  ?                    ????????????????                            ?   ?
?  ??????????????????????????????????????????????????????????????????   ?
?                              ?                                        ?
?  ??????????????????????????????????????????????????????????????????  ?
?  ?              Application Layer (Managers)                      ?  ?
?  ?   ???????????????????              ???????????????????        ?  ?
?  ?   ?  UserManager    ?              ?  RoomManager    ?        ?  ?
?  ?   ?  (Singleton)    ?              ?  (Singleton)    ?        ?  ?
?  ?   ???????????????????              ???????????????????        ?  ?
?  ?????????????????????????????????????????????????????????????????  ?
?               ?                                 ?                   ?
?  ?????????????????????????????????????????????????????????????????  ?
?  ?                     Core Layer                                 ?  ?
?  ?   ????????????????    ????????????????    ???????????????    ?  ?
?  ?   ?  Interfaces  ?    ?    Models    ?    ?    DTOs     ?    ?  ?
?  ?   ? IUserManager ?    ?UserConnection?    ?  Messages   ?    ?  ?
?  ?   ? IRoomManager ?    ?     Room     ?    ?  Candidates ?    ?  ?
?  ?   ????????????????    ????????????????    ???????????????    ?  ?
?  ??????????????????????????????????????????????????????????????????  ?
?                                                                       ?
?  ??????????????????????????????????????????????????????????????????  ?
?  ?                    Data Storage Layer                          ?  ?
?  ?         ConcurrentDictionary<string, UserConnection>           ?  ?
?  ?         ConcurrentDictionary<string, Room>                     ?  ?
?  ??????????????????????????????????????????????????????????????????  ?
?????????????????????????????????????????????????????????????????????????
```

---

## 2. WebRTC Connection Flow (1-to-1 Call)

```
??????????????                                              ??????????????
?   Alice    ?                                              ?    Bob     ?
?  (Caller)  ?                                              ?  (Callee)  ?
??????????????                                              ??????????????
      ?                                                            ?
      ? 1. Click "Call Bob"                                       ?
      ?                                                            ?
      ? 2. createPeerConnection(bob)                              ?
      ?    ?? Create RTCPeerConnection                            ?
      ?    ?? Add local tracks (video/audio)                      ?
      ?    ?? Set up event handlers                               ?
      ?                                                            ?
      ? 3. createOffer()                                          ?
      ?    ?? Generate SDP offer                                  ?
      ?    ?? setLocalDescription(offer)                          ?
      ?                                                            ?
      ? 4. SignalR: CallUser(bob, offer)                          ?
      ?????????????????????????????????????????????????????????????
      ?                                   5. Receive: ReceiveOffer?
      ?                                      createPeerConnection  ?
      ?                                      setRemoteDescription  ?
      ?                                                            ?
      ?                                   6. createAnswer()        ?
      ?                                      setLocalDescription   ?
      ?                                                            ?
      ? 7. Receive: ReceiveAnswer????????????????????????????????????
      ?    setRemoteDescription(answer)    SignalR: AnswerCall     ?
      ?                                                            ?
      ? ??????????????? ICE Candidate Exchange ????????????????????
      ?                                                            ?
      ? 8. onicecandidate fires                                    ?
      ??????????? SendIceCandidate(bob, candidate) ????????????????
      ?                                    9. addIceCandidate      ?
      ?                                                            ?
      ? 10. addIceCandidate   ????????? SendIceCandidate(alice) ???
      ?                                    onicecandidate fires    ?
      ?                                                            ?
      ? ??????????????? Connection Established ?????????????????? ?
      ?                                                            ?
      ? 11. ontrack fires                                          ?
      ?     Display Bob's video                                    ?
      ?                                                            ?
      ?                                   12. ontrack fires        ?
      ?                                       Display Alice's video?
      ?                                                            ?
      ? ?????????????? Media Flowing (Audio + Video) ???????????? ?
      ?                                                            ?
      ? 13. connectionState: 'connected'                           ?
      ?                                   14. connectionState:     ?
      ?                                       'connected'          ?
      ?                                                            ?
??????????????                                              ??????????????
?   Alice    ? ????????????? Active Call ???????????????????    Bob     ?
?  Connected ?                                              ?  Connected ?
??????????????                                              ??????????????
```

---

## 3. Multi-User Room Flow (Full Mesh)

```
Time: T0
??????????????
?   Alice    ?
?  Creates   ?
?  "Room1"   ?
??????????????
      ?
      ? CreateRoom("Room1")
      ???????????????????????????????????????
      ?                       ?   Server    ?
      ?????????????????????????  RoomMgr    ?
      ? RoomCreated("Room1")  ???????????????
      ?
      ? Room1: [Alice]
      ?
      
Time: T1 (Bob joins)
??????????????                                    ??????????????
?   Alice    ?                                    ?    Bob     ?
?  In Room1  ?                                    ?  Joining   ?
??????????????                                    ??????????????
      ?                                                  ?
      ?????????????? UserJoinedRoom(Bob) ????????????????
      ?                                                  ?
      ?                                                  ?
      ?????????????? CreateOffer(Bob) ???????????????????
      ?                                                  ?
      ?????????????? Answer(Alice) ???????????????????????
      ?                                                  ?
      ????????????? A-B Connection ?????????????????????
      ?                                                  ?
      ? Room1: [Alice, Bob]                             ?
      

Time: T2 (Charlie joins)
??????????????    ??????????????    ??????????????
?   Alice    ?    ?    Bob     ?    ?  Charlie   ?
?  In Room1  ?    ?  In Room1  ?    ?  Joining   ?
??????????????    ??????????????    ??????????????
      ?                  ?                  ?
      ????????????? UserJoinedRoom(Charlie) ?
      ?                  ?                  ?
      ????????????? UserJoinedRoom(Charlie) ?
      ?                  ?                  ?
      ?????? CreateOffer(Charlie) ????????????
      ?                  ?                  ?
      ?                  ???? Offer(C) ??????
      ?                  ?                  ?
      ????????? Answer(Alice) ????????????????
      ?                  ?                  ?
      ?                  ?????? Answer(Bob) ?
      ?                  ?                  ?
      ???????? A-C ???????                  ?
      ?                  ????? B-C ??????????
      ???????? A-B ???????                  ?
      ?                                     ?
      ? Room1: [Alice, Bob, Charlie]       ?
      ?                                     ?
      ? Full Mesh:                          ?
      ?   Alice ? Bob                       ?
      ?   Alice ? Charlie                   ?
      ?   Bob   ? Charlie                   ?
      ?                                     ?

Connection Topology:
        Alice
         / \
        /   \
       /     \
     Bob ??? Charlie

Each user maintains (N-1) connections where N = total users
For 3 users: 3 connections total (fully connected mesh)
```

---

## 4. Data Flow Layers

```
???????????????????????????????????????????????????????????????????
?                          UI Layer                                ?
?  ????????????  ????????????  ????????????  ????????????       ?
?  ? Register ?  ?   Call   ?  ?  Room    ?  ?  Video   ?       ?
?  ?  Button  ?  ?  Button  ?  ?  Button  ?  ?  Grid    ?       ?
?  ????????????  ????????????  ????????????  ????????????       ?
??????????????????????????????????????????????????????????????????
        ?             ?             ?             ?
??????????????????????????????????????????????????????????????????
?                   Component Layer                                ?
?               (VideoChat.ts Component)                           ?
?  ????????????????????????????????????????????????????????       ?
?  ? State Management:                                     ?       ?
?  ?  - users[]                                            ?       ?
?  ?  - localStream                                        ?       ?
?  ?  - remoteStreams{}                                    ?       ?
?  ?  - currentRoomId                                      ?       ?
?  ???????????????????????????????????????????????????????        ?
?????????????????????????????????????????????????????????????????
                     ?
?????????????????????????????????????????????????????????????????
?                   Service Layer                                ?
?  ???????????????????????????  ????????????????????????????    ?
?  ?   SignalRService        ?  ?   WebRTCService          ?    ?
?  ?  ????????????????????   ?  ?  ?????????????????????  ?    ?
?  ?  ?  HubConnection   ?   ?  ?  ?  localStream      ?  ?    ?
?  ?  ?  - State         ?   ?  ?  ?  peerConnections{}?  ?    ?
?  ?  ?  - Events        ?   ?  ?  ?  configuration    ?  ?    ?
?  ?  ????????????????????   ?  ?  ?????????????????????  ?    ?
?  ???????????????????????????  ???????????????????????????    ?
????????????????????????????????????????????????????????????????
               ?                            ?
        ?????????????????            ??????????????
        ?   SignalR     ?            ?   WebRTC   ?
        ?   Messages    ?            ?   P2P      ?
        ?????????????????            ??????????????
               ?                           ?
???????????????????????????????????????????????????????????????
?                    Network Layer                             ?
?  ????????????????????             ????????????????????      ?
?  ?   WebSocket      ?             ?   UDP/RTP        ?      ?
?  ?   (Signaling)    ?             ?   (Media)        ?      ?
?  ????????????????????             ????????????????????      ?
????????????????????????????????????????????????????????????????
            ?                               ?
?????????????????????????????    ?????????????????????????
?   ASP.NET Core Server     ?    ?   Direct P2P          ?
?   ????????????????????    ?    ?   (via TURN/STUN)     ?
?   ?  VideoCallHub    ?    ?    ?                        ?
?   ?  ??RegisterUser  ?    ?    ?  ???????????????????  ?
?   ?  ??CallUser      ?    ?    ?  ? Media Streams   ?  ?
?   ?  ??JoinRoom      ?    ?    ?  ?  Audio + Video  ?  ?
?   ?  ??LeaveRoom     ?    ?    ?  ???????????????????  ?
?   ????????????????????    ?    ?                        ?
?            ?               ?    ??????????????????????????
?   ????????????????????    ?
?   ?   Managers       ?    ?
?   ?  ?????????????   ?    ?
?   ?  ?UserManager?   ?    ?
?   ?  ?RoomManager?   ?    ?
?   ?  ?????????????   ?    ?
?   ????????????????????    ?
?            ?               ?
?   ????????????????????    ?
?   ?  Core Models     ?    ?
?   ? UserConnection   ?    ?
?   ? Room             ?    ?
?   ????????????????????    ?
?                            ?
?   ????????????????????    ?
?   ?  Data Store      ?    ?
?   ?  ConcurrentDict  ?    ?
?   ????????????????????    ?
??????????????????????????????
```

---

## 5. Clean Architecture Layers

```
???????????????????????????????????????????????????????????????????
?                     Presentation Layer                          ?
?                      (Program.cs)                               ?
?                                                                 ?
?  Responsibilities:                                              ?
?  • Configure services (DI)                                      ?
?  • Configure middleware pipeline                                ?
?  • Map endpoints                                                ?
?                                                                 ?
?  Dependencies: ?                                                ?
???????????????????????????????????????????????????????????????????
                            ?
???????????????????????????????????????????????????????????????????
?                  Infrastructure Layer                           ?
?                      (Hubs/)                                    ?
?                                                                 ?
?  ????????????????????????????????????????????????????????????  ?
?  ?              VideoCallHub.cs                             ?  ?
?  ?  ??????????????????????????????????????????????????????  ?  ?
?  ?  ?  Responsibilities:                                  ?  ?  ?
?  ?  ?  • Receive SignalR messages                         ?  ?  ?
?  ?  ?  • Validate input                                   ?  ?  ?
?  ?  ?  • Delegate to managers                             ?  ?  ?
?  ?  ?  • Send responses                                   ?  ?  ?
?  ?  ?                                                      ?  ?  ?
?  ?  ?  Depends on: IUserManager, IRoomManager, ILogger    ?  ?  ?
?  ?  ??????????????????????????????????????????????????????  ?  ?
?  ????????????????????????????????????????????????????????????  ?
?                                                                 ?
?  Dependencies: ?                                                ?
???????????????????????????????????????????????????????????????????
                            ?
???????????????????????????????????????????????????????????????????
?                  Application Layer                              ?
?                     (Managers/)                                 ?
?                                                                 ?
?  ???????????????????????????    ?????????????????????????????? ?
?  ?   UserManager.cs        ?    ?   RoomManager.cs           ? ?
?  ?  ?????????????????????  ?    ?  ???????????????????????? ? ?
?  ?  ? Responsibilities: ?  ?    ?  ? Responsibilities:    ? ? ?
?  ?  ? • User CRUD       ?  ?    ?  ? • Room CRUD          ? ? ?
?  ?  ? • State mgmt      ?  ?    ?  ? • State mgmt         ? ? ?
?  ?  ? • Thread safety   ?  ?    ?  ? • Thread safety      ? ? ?
?  ?  ?                   ?  ?    ?  ?                      ? ? ?
?  ?  ? Implements:       ?  ?    ?  ? Implements:          ? ? ?
?  ?  ? IUserManager      ?  ?    ?  ? IRoomManager         ? ? ?
?  ?  ?????????????????????  ?    ?  ???????????????????????? ? ?
?  ???????????????????????????    ?????????????????????????????? ?
?                                                                 ?
?  Dependencies: ?                                                ?
???????????????????????????????????????????????????????????????????
                            ?
???????????????????????????????????????????????????????????????????
?                      Core Layer                                 ?
?                   (Core/Models, Core/Interfaces)                ?
?                                                                 ?
?  ????????????????????????????????????????????????????????????  ?
?  ?                      Interfaces                          ?  ?
?  ?  ??????????????????????    ?????????????????????????    ?  ?
?  ?  ?  IUserManager      ?    ?  IRoomManager         ?    ?  ?
?  ?  ?  ????????????????  ?    ?  ???????????????????  ?    ?  ?
?  ?  ?  ? Contracts:   ?  ?    ?  ? Contracts:      ?  ?    ?  ?
?  ?  ?  ? • AddUser    ?  ?    ?  ? • CreateRoom    ?  ?    ?  ?
?  ?  ?  ? • RemoveUser ?  ?    ?  ? • JoinRoom      ?  ?    ?  ?
?  ?  ?  ? • GetUser    ?  ?    ?  ? • LeaveRoom     ?  ?    ?  ?
?  ?  ?  ????????????????  ?    ?  ???????????????????  ?    ?  ?
?  ?  ??????????????????????    ?????????????????????????    ?  ?
?  ????????????????????????????????????????????????????????????  ?
?                                                                 ?
?  ????????????????????????????????????????????????????????????  ?
?  ?                       Models                             ?  ?
?  ?  ????????????????????  ????????????????  ?????????????  ?  ?
?  ?  ? UserConnection   ?  ?    Room      ?  ? Messages  ?  ?  ?
?  ?  ? ???????????????? ?  ? ???????????? ?  ? Signaling ?  ?  ?
?  ?  ? ? Properties:  ? ?  ? ?Props:    ? ?  ? ICE       ?  ?  ?
?  ?  ? ? • UserId     ? ?  ? ?• RoomId  ? ?  ?????????????  ?  ?
?  ?  ? ? • ConnId     ? ?  ? ?• Users[] ? ?                 ?  ?
?  ?  ? ? • RoomId     ? ?  ? ?• Creator ? ?                 ?  ?
?  ?  ? ???????????????? ?  ? ???????????? ?                 ?  ?
?  ?  ????????????????????  ????????????????                 ?  ?
?  ????????????????????????????????????????????????????????????  ?
?                                                                 ?
?  No dependencies (Pure domain)                                  ?
???????????????????????????????????????????????????????????????????

Dependency Direction: Presentation ? Infrastructure ? Application ? Core
                      (Always inward, never outward)
```

---

## 6. SOLID Principles Map

```
???????????????????????????????????????????????????????????????????
?  S - Single Responsibility Principle                            ?
???????????????????????????????????????????????????????????????????
?                                                                 ?
?  UserManager        ?  Manages users only                       ?
?  RoomManager        ?  Manages rooms only                       ?
?  VideoCallHub       ?  Handles communication only               ?
?  SignalRService     ?  Handles WebSocket only                   ?
?  WebRTCService      ?  Handles peer connections only            ?
?                                                                 ?
?  ? Each class has ONE reason to change                         ?
???????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????????
?  O - Open/Closed Principle                                      ?
???????????????????????????????????????????????????????????????????
?                                                                 ?
?  IUserManager  ?  Can add new implementations without changing  ?
?  IRoomManager  ?  existing code                                 ?
?                                                                 ?
?  Example:                                                       ?
?  ????????????????         ???????????????????                  ?
?  ?IUserManager  ???????????  UserManager    ? (In-memory)      ?
?  ?  interface   ???????????  RedisUserMgr   ? (Redis)          ?
?  ????????????????    ?    ???????????????????                  ?
?                      ?                                          ?
?                  Extensible                                     ?
?                                                                 ?
?  ? Open for extension, closed for modification                 ?
???????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????????
?  L - Liskov Substitution Principle                              ?
???????????????????????????????????????????????????????????????????
?                                                                 ?
?  VideoCallHub                                                   ?
?       ?                                                         ?
?       ? depends on                                              ?
?       ?                                                         ?
?  IUserManager ????                                              ?
?       ?         ?                                               ?
?       ?         ? can be replaced by                            ?
?       ?         ?                                               ?
?  ????????????   ?                                               ?
?  ?UserMgr   ?????                                               ?
?  ?RedisMgr  ?????? (same behavior)                              ?
?  ?DbMgr     ?????? (same behavior)                              ?
?  ????????????                                                   ?
?                                                                 ?
?  ? Implementations are interchangeable                         ?
???????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????????
?  I - Interface Segregation Principle                            ?
???????????????????????????????????????????????????????????????????
?                                                                 ?
?  ??????????????????     Not one large interface:               ?
?  ? IUserManager   ?     ? IManager { users, rooms, calls...}  ?
?  ?  7 methods     ?                                             ?
?  ??????????????????     Instead, focused interfaces:            ?
?                                                                 ?
?  ??????????????????     ? IUserManager (user ops only)        ?
?  ? IRoomManager   ?     ? IRoomManager (room ops only)        ?
?  ?  6 methods     ?                                             ?
?  ??????????????????                                             ?
?                                                                 ?
?  VideoCallHub uses both interfaces, but only what it needs     ?
?                                                                 ?
?  ? Clients not forced to depend on unused methods              ?
???????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????????
?  D - Dependency Inversion Principle                             ?
???????????????????????????????????????????????????????????????????
?                                                                 ?
?  High-level module:                                             ?
?  ????????????????????                                           ?
?  ?  VideoCallHub    ? ? Does NOT depend on concrete classes    ?
?  ????????????????????                                           ?
?           ?                                                     ?
?           ? depends on (?)                                      ?
?           ?                                                     ?
?  ????????????????????                                           ?
?  ?  IUserManager    ? ? Abstraction                             ?
?  ?  IRoomManager    ?                                           ?
?  ????????????????????                                           ?
?           ?                                                     ?
?           ? implemented by (?)                                  ?
?           ?                                                     ?
?  ????????????????????                                           ?
?  ?  UserManager     ? ? Low-level module                        ?
?  ?  RoomManager     ?                                           ?
?  ????????????????????                                           ?
?                                                                 ?
?  Dependency Injection (DI):                                     ?
?  services.AddSingleton<IUserManager, UserManager>();           ?
?                                                                 ?
?  ? Both depend on abstractions, not concrete implementations   ?
???????????????????????????????????????????????????????????????????
```

---

## 7. Thread Safety Visualization

```
???????????????????????????????????????????????????????????????????
?         Concurrent User Registration (Thread Safe)              ?
???????????????????????????????????????????????????????????????????
?                                                                 ?
?  Time: T0                                                       ?
?  ??????????   ??????????   ??????????                          ?
?  ?Thread 1?   ?Thread 2?   ?Thread 3?                          ?
?  ? Alice  ?   ?  Bob   ?   ?Charlie ?                          ?
?  ??????????   ??????????   ??????????                          ?
?      ?            ?            ?                                ?
?      ? Register   ? Register   ? Register                       ?
?      ?            ?            ?                                ?
?  ????????????????????????????????????????                       ?
?  ?    ConcurrentDictionary<string,      ?                       ?
?  ?         UserConnection>              ?                       ?
?  ?                                       ?                       ?
?  ?  ??????????????????????????????????? ?                       ?
?  ?  ? Thread-Safe Operations:         ? ?                       ?
?  ?  ?  • TryAdd()                     ? ?                       ?
?  ?  ?  • TryRemove()                  ? ?                       ?
?  ?  ?  • TryGetValue()                ? ?                       ?
?  ?  ?                                 ? ?                       ?
?  ?  ? No explicit locking needed!     ? ?                       ?
?  ?  ??????????????????????????????????? ?                       ?
?  ????????????????????????????????????????                       ?
?      ?            ?            ?                                ?
?  Time: T1                                                       ?
?      ?            ?            ?                                ?
?  ????????????????????????????????????????                       ?
?  ?  State:                              ?                       ?
?  ?  {                                   ?                       ?
?  ?    "alice":   UserConnection {...},  ?                       ?
?  ?    "bob":     UserConnection {...},  ?                       ?
?  ?    "charlie": UserConnection {...}   ?                       ?
?  ?  }                                   ?                       ?
?  ?                                       ?                       ?
?  ?  ? All three users registered        ?                       ?
?  ?  ? No race conditions                ?                       ?
?  ?  ? No data corruption                ?                       ?
?  ????????????????????????????????????????                       ?
?                                                                 ?
???????????????????????????????????????????????????????????????????

Why ConcurrentDictionary?
??????????????????????????????????????????????????????????????????
?                                                                ?
?  Regular Dictionary:          ConcurrentDictionary:            ?
?  ? Not thread-safe            ? Thread-safe by design         ?
?  ? Needs explicit locks       ? Lock-free operations          ?
?  ? Performance bottleneck     ? High concurrent performance   ?
?  ? Risk of deadlocks          ? No deadlock risk             ?
?                                                                ?
??????????????????????????????????????????????????????????????????
```

---

## 8. Scalability Evolution

```
???????????????????????????????????????????????????????????????????
?                   Phase 1: Current (Single Server)              ?
???????????????????????????????????????????????????????????????????
?                                                                 ?
?  Users: 1-100                                                   ?
?  Rooms: 1-20                                                    ?
?  State: In-Memory                                               ?
?                                                                 ?
?  ????????????????                                               ?
?  ?   Browser    ????????????????                                ?
?  ????????????????               ?                                ?
?  ????????????????               ?                                ?
?  ?   Browser    ?????????      ?                                ?
?  ????????????????       ?      ?                                ?
?  ????????????????       ?      ?                                ?
?  ?   Browser    ??????  ?      ?                                ?
?  ????????????????    ?  ?      ?                                ?
?                      ?  ?      ?                                ?
?                   ????????????????????                          ?
?                   ?  ASP.NET Server  ?                          ?
?                   ?  ??????????????  ?                          ?
?                   ?  ? In-Memory  ?  ?                          ?
?                   ?  ?   State    ?  ?                          ?
?                   ?  ??????????????  ?                          ?
?                   ????????????????????                          ?
?                                                                 ?
?  Limitations:                                                   ?
?  • Single point of failure                                      ?
?  • Limited by single server resources                           ?
?  • No horizontal scaling                                        ?
?                                                                 ?
???????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????????
?              Phase 2: Redis Backplane (Multi-Server)            ?
???????????????????????????????????????????????????????????????????
?                                                                 ?
?  Users: 100-10,000                                              ?
?  Rooms: 20-1,000                                                ?
?  State: Shared (Redis)                                          ?
?                                                                 ?
?  ????????????  ????????????  ????????????                      ?
?  ? Browser  ?  ? Browser  ?  ? Browser  ?                      ?
?  ????????????  ????????????  ????????????                      ?
?        ?             ?             ?                            ?
?        ?       ???????????????????????????                      ?
?        ?       ?   Load Balancer          ?                      ?
?        ?       ?  (Sticky Sessions)       ?                      ?
?        ?       ???????????????????????????                      ?
?        ?             ?             ?                            ?
?     ?????????????? ?????????????? ?????????????                ?
?     ? Server 1   ? ? Server 2   ? ? Server 3  ?                ?
?     ?????????????? ?????????????? ?????????????                ?
?           ?                ?             ?                      ?
?           ????????????????????????????????                      ?
?                            ?                                    ?
?                   ???????????????????                           ?
?                   ?  Redis Server   ?                           ?
?                   ?  ?????????????  ?                           ?
?                   ?  ?  Shared   ?  ?                           ?
?                   ?  ?   State   ?  ?                           ?
?                   ?  ? + Backplane?  ?                           ?
?                   ?  ?????????????  ?                           ?
?                   ???????????????????                           ?
?                                                                 ?
?  Benefits:                                                      ?
?  • Horizontal scaling                                           ?
?  • Fault tolerance                                              ?
?  • Shared state across servers                                 ?
?                                                                 ?
???????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????????
?          Phase 3: SFU Architecture (Large Scale)                ?
???????????????????????????????????????????????????????????????????
?                                                                 ?
?  Users: 10,000+                                                 ?
?  Rooms: 1,000+                                                  ?
?  Users per room: 100+                                           ?
?                                                                 ?
?  Full Mesh (Current):           SFU (Scalable):                 ?
?                                                                 ?
?       User A                         User A                     ?
?        / \                             ?                        ?
?       /   \                            ? Upload                 ?
?      /     \                           ?                        ?
?   User B ? User C          ?????????????????????               ?
?                            ?   SFU Server      ?               ?
?  Bandwidth: N×(N-1)        ?   (mediasoup)     ?               ?
?  3 users = 6 streams       ?????????????????????               ?
?                                    ?   ?   ?                    ?
?                            Download?   ?   ?                    ?
?                                    ?   ?   ?                    ?
?                                 User A B   C                    ?
?                                                                 ?
?                            Bandwidth: N streams total           ?
?                            Each user: 1 upload + (N-1) downloads?
?                                                                 ?
?  Benefits:                                                      ?
?  • Supports 100+ users per room                                 ?
?  • Reduced bandwidth per client                                ?
?  • Quality adaptation per client                               ?
?  • Recording and transcoding possible                           ?
?                                                                 ?
???????????????????????????????????????????????????????????????????

Migration Path:
  Current ? Redis Backplane ? SFU
   (Now)     (100+ users)      (1000+ users)
```

---

## 9. Security Architecture (Recommended)

```
???????????????????????????????????????????????????????????????????
?                Current (Development)                            ?
???????????????????????????????????????????????????????????????????
?                                                                 ?
?  ????????????                                                   ?
?  ? Browser  ?                                                   ?
?  ????????????                                                   ?
?        ?                                                        ?
?        ? No Authentication ?                                    ?
?        ? CORS: Allow All ?                                      ?
?        ?                                                        ?
?     ???????????????                                             ?
?     ?   Server    ?                                             ?
?     ? Anonymous   ?                                             ?
?     ???????????????                                             ?
?                                                                 ?
???????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????????
?              Production (Recommended)                           ?
???????????????????????????????????????????????????????????????????
?                                                                 ?
?  ????????????                                                   ?
?  ? Browser  ?                                                   ?
?  ????????????                                                   ?
?        ?                                                        ?
?        ? 1. Login (Username/Password)                           ?
?        ?                                                        ?
?  ??????????????????                                             ?
?  ? Auth Provider  ? (Identity Server, Auth0, etc.)             ?
?  ?  (OAuth/OIDC)  ?                                             ?
?  ??????????????????                                             ?
?          ?                                                      ?
?          ? 2. Return JWT Token                                  ?
?          ?                                                      ?
?  ????????????                                                   ?
?  ? Browser  ?                                                   ?
?  ? (Token)  ?                                                   ?
?  ????????????                                                   ?
?        ?                                                        ?
?        ? 3. SignalR Connect (Token in query)                    ?
?        ?    wss://server/hub?access_token=JWT                   ?
?        ?                                                        ?
?  ???????????????????????????                                    ?
?  ?  API Gateway/Firewall   ?                                    ?
?  ?  ?????????????????????  ?                                    ?
?  ?  ? - Rate Limiting   ?  ?                                    ?
?  ?  ? - DDoS Protection ?  ?                                    ?
?  ?  ? - IP Whitelist    ?  ?                                    ?
?  ?  ?????????????????????  ?                                    ?
?  ???????????????????????????                                    ?
?               ?                                                 ?
?               ? 4. Validate Token                               ?
?               ?                                                 ?
?  ?????????????????????????                                      ?
?  ?  [Authorize] Hub      ?                                      ?
?  ?  ???????????????????  ?                                      ?
?  ?  ? Claims:         ?  ?                                      ?
?  ?  ? • User ID       ?  ?                                      ?
?  ?  ? • Name          ?  ?                                      ?
?  ?  ? • Roles         ?  ?                                      ?
?  ?  ? • Permissions   ?  ?                                      ?
?  ?  ???????????????????  ?                                      ?
?  ?????????????????????????                                      ?
?                                                                 ?
?  Security Layers:                                               ?
?  ? Authentication (JWT)                                         ?
?  ? Authorization (Role-based)                                   ?
?  ? Rate Limiting                                                ?
?  ? HTTPS Only                                                   ?
?  ? CORS Restricted                                              ?
?  ? Input Validation                                             ?
?  ? Audit Logging                                                ?
?                                                                 ?
???????????????????????????????????????????????????????????????????
```

---

**For more detailed diagrams and flows, see:**
- [ARCHITECTURE.md](ARCHITECTURE.md) - Full architecture details
- [README.md](README.md) - Feature flows
- [API.md](API.md) - API contracts

---

*These diagrams provide a visual reference for understanding the system architecture, data flows, and design principles.*
